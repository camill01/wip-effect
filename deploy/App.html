<!DOCTYPE html>
<html>
<head>
    <title>wip-effect</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.TimeboxScopedApp",scopeType:"release",app:null,filterContainer:null,contentContainer:null,firstLaunch:!1,THEME_COLOR:"#821100",fromDate:null,toDate:null,launch:function(){app=this,app.firstLaunch=!0,filterContainer=app.down("container"),contentContainer=app.add({xype:"box",border:0}),app.callParent(arguments)},onScopeChange:function(scope){app.callParent(arguments),app.initializeFilters()},initializeFilters:function(){if(app.hideHeader(!1),filterContainer){var fromDateFieldId="fromDateFilter",toDateFieldId="toDateFilter",beginButtonId="beginButton",fromDateField=filterContainer.down("#"+fromDateFieldId),toDateField=filterContainer.down("#"+toDateFieldId),beginButton=filterContainer.down("#"+beginButtonId);toDateField||(filterContainer.add({xtype:"label",html:"--or--<br/>"}),fromDateField=filterContainer.add({xtype:"datefield",anchor:"100%",fieldLabel:"From",itemId:fromDateFieldId,name:"from_date",stateful:!0,stateId:app.getContext().getScopedStateId("fromDate")}),toDateField=filterContainer.add({xtype:"datefield",anchor:"100%",fieldLabel:"To",itemId:toDateFieldId,name:"to_date",stateful:!0,stateId:app.getContext().getScopedStateId("toDate")}),filterContainer.add({xtype:"rallybutton",itemId:beginButtonId,text:"Apply Date Range",handler:function(){app.beginButtonHandler(fromDateField,toDateField)},style:{"background-color":"#61257a","border-color":"#61257a"}}),app.firstLaunch&&(fromDateField.value||toDateField.value||app.getContext().getTimeboxScope().getRecord())&&(app.firstLaunch=!1,app.beginButtonHandler(fromDateField,toDateField)))}else app.beginButtonHandler(null,null)},beginButtonHandler:function(fromDateField,toDateField){app.clearContent(!1);var scope=app.getContext().getTimeboxScope().getRecord(),fromDate=null;fromDateField&&fromDateField.value&&(fromDate=fromDateField.value),!fromDate&&scope&&(fromDate=scope.get("ReleaseStartDate"));var toDate=null;toDateField&&toDateField.value&&(toDate=toDateField.value),!toDate&&scope&&(toDate=scope.get("ReleaseDate")),this.fromDate=fromDate,this.toDate=toDate,this.fetchWorkItems(fromDate)},fetchWorkItems:function(date){app._myMask=new Ext.LoadMask(Ext.getBody(),{msg:"Calculating... Please wait."}),app._myMask.show(),this._myMask=new Ext.LoadMask(Ext.getBody(),{msg:"Calculating... Please wait."}),this._myMask.show(),console.log(this.getContext().getDataContext());var snapshotStore=Ext.create("Rally.data.lookback.SnapshotStore",{fetch:["Name","ScheduleState","PlanEstimate"],autoLoad:!0,listeners:{load:this.onDateLoaded,scope:this},context:this.getContext().getDataContext(),limit:1/0,hydrate:["ScheduleState"],find:{ScheduleState:"In-Progress",__At:date.toISOString()}})},onDateLoaded:function(store,records){console.log(records)},countWeekDays:function(dDate1,dDate2){for(var days=0,dateItr=dDate1;dateItr<dDate2;)dateItr.setHours(dateItr.getHours()+6),6!=dateItr.getDay()&&0!==dateItr.getDay()&&(days+=.25);return days},showMessage:function(text){app._myMask.hide(),contentContainer.add({xtype:"label",text:text})},hideHeader:function(hiddenValue){filterContainer&&filterContainer.setVisible(!hiddenValue)},clearContent:function(keepCharts){for(;contentContainer.down("label");)contentContainer.down("label").destroy();for(;contentContainer.down("button");)contentContainer.down("button").destroy();for(;contentContainer.down("rallygrid");)contentContainer.down("rallygrid").destroy();for(;contentContainer.down("textareafield");)contentContainer.down("textareafield").destroy();if(!keepCharts)for(;contentContainer.down("rallychart");)contentContainer.down("rallychart").destroy()}});

            Rally.launchApp('CustomApp', {
                name:"wip-effect",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
